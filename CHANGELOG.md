# Changelog

## 2026-02-16
- SQLite tabanlı durum saklama katmanı eklendi: `src/state_store.py`.
- Ana mesaj akışına idempotency koruması eklendi; aynı Telegram mesajı tekrar işlenmiyor (`src/main.py`).
- Sinyal yaşam döngüsü kayıtları kalıcı hale getirildi: `received`, `parsed`, `approved/rejected`, `executed/execution_error`.
- Yeni ayar eklendi: `STATE_DB_PATH` (`src/config.py`, `.env.example`).
- State store için unit testler eklendi: `tests/test_state_store.py`.
- Testler çalıştırıldı: `.venv\\Scripts\\python -m pytest -q` sonucu `6 passed`.
- Executor akışına transient hatalar için retry/backoff eklendi (`src/executor.py`).
- Yeni retry ayarları eklendi: `EXECUTOR_MAX_RETRIES`, `EXECUTOR_RETRY_DELAY_MS` (`src/config.py`, `.env.example`).
- Retry davranışı için unit testler eklendi: `tests/test_executor_retry.py`.
- Smoke script `STATE_DB_PATH` ve retry ayarlarıyla güncellendi (`scripts/dry_run_smoke.py`).
- Testler tekrar çalıştırıldı: `.venv\\Scripts\\python -m pytest -q` sonucu `9 passed`.
- Dry-run UAT state doğrulaması çalıştırıldı; `data/state.db` üzerinde `executed` durum kaydı teyit edildi.
- Runtime artefaktları için `.gitignore` güncellendi: `data/*.db`, `logs/`, `downloads/`.
- Onay mesaj/komut akışı statik `APPROVAL_CHAT_ID` yerine sinyalin geldiği chat'e yönlendirildi (`src/main.py`, `src/approvals.py`).
- Approval komutları sadece ilgili sinyalin beklenen chat'inden geldiğinde işleniyor (`src/approvals.py`).
- Regresyon testleri tekrar çalıştırıldı: `.venv\\Scripts\\python -m pytest -q` sonucu `9 passed`.
- Bot-token tabanlı başlatma eklendi: `client.start(bot_token=...)` (`src/main.py`).
- Yeni zorunlu env alanı eklendi: `TELEGRAM_BOT_TOKEN` (`src/config.py`, `.env.example`).
- Bot-token mimarisine göre runbook güncellendi (`RUNBOOK.md`).
- Regresyon + smoke doğrulaması tekrar çalıştırıldı: `pytest` sonucu `9 passed`, `scripts/dry_run_smoke.py` başarılı.
- Hibrit mimari eklendi: kanal dinleme Telethon user session, onay/komut ve bildirim akışı Bot API üzerinden (`src/main.py`, `src/bot_approvals.py`).
- Bot onay servisi eklendi: `/approve`, `/reject`, `/edit` komutları bot chatinde polling ile işleniyor (`src/bot_approvals.py`).
- Chat hedef parse desteği eklendi (`-100...` veya username): `src/config.py`.
- Runbook hibrit gerçekliğe göre güncellendi; botun kanalda olma zorunluluğu kaldırıldı, `/start` + `APPROVAL_CHAT_ID` gereksinimi netleştirildi (`RUNBOOK.md`).
- Yeni test eklendi: `tests/test_bot_approvals.py`; test sonucu `10 passed`.
- Approval UX inline butonlarla iyileştirildi: `Approve`, `Reject`, `Market`, `5x`, `10x` (`src/bot_approvals.py`).
- Callback query işleme eklendi; komutlar fallback olarak korundu (`src/bot_approvals.py`).
- Bot approval testleri genişletildi: keyboard/callback-data doğrulaması (`tests/test_bot_approvals.py`), test sonucu `12 passed`.
- Startup bildirimi sade "Hybrid mode active" metninden estetik bir durum kartına geçirildi (`src/main.py`).
- Başlangıç kartında `Started`, `Listener channel`, `Approval chat`, `Mode`, `Exchange` bilgileri gösteriliyor.
- Startup kartı emoji'li bir UX formatına güncellendi (`src/main.py`).
- Kanal etiketi entity'den çözümlenerek ad/username gösteriliyor; ham chat ID görünümü kaldırıldı (`src/main.py`).
- Approval chat alanı ID yerine kullanıcı dostu etiketle gösteriliyor (`src/main.py`).
- Onay akışına pozisyon boyutu seçimi eklendi: inline `%25/%50/%100` butonları ve `/size <id> <usdt|%>` komutu (`src/bot_approvals.py`).
- Size seçilmeden onay engellendi; onay kararında `position_size_usdt` sinyale işleniyor (`src/bot_approvals.py`, `src/models.py`).
- Executor hesaplaması seçilen `position_size_usdt` ile çalışacak şekilde güncellendi ve `paper_total_balance_usdt` üst sınır kontrolü eklendi (`src/executor.py`, `src/config.py`).
- Yeni ayar eklendi: `PAPER_TOTAL_BALANCE_USDT` (varsayılan 50) (`.env.example`, `src/config.py`).
- Startup kartına paper bakiye bilgisi eklendi ve runbook yeni size akışıyla güncellendi (`src/main.py`, `RUNBOOK.md`).
- Test sonucu `13 passed`, smoke script doğrulaması başarılı.

## 2026-02-15
- Plan dokümanları konsolide edildi: `trading_bot_plan.md` master plan olarak güncellendi.
- `telegram-trading-bot-implementation-roadmap.md` birleşim notu dosyasına dönüştürüldü.
- Süreç dosyaları eklendi: `AGENTS.md`, `TASKS.md`, `LOG.md`, `MEMORY.md`.
- Proje iskeleti eklendi: `requirements.txt`, `.env.example`, `src/*`.
- Telethon listener event hattı ve ham mesaj loglama iskeleti eklendi.
- Parser için strict JSON schema doğrulaması eklendi (`src/parser.py`, `jsonschema` bağımlılığı).
- Global çalışma protokolü güncellendi: `C:\Users\ceyca\.codex\CODEX.md` ve `C:\Users\ceyca\.codex\MEMORY.md`.
- Userbot onay komutları eklendi: `/approve`, `/reject`, `/edit` (`src/approvals.py`, `src/main.py`).
- Executor akışı eklendi: market/limit entry, TP/SL girişimleri, action logları (`src/executor.py`).
- Güvenli varsayılanlar eklendi: `DRY_RUN`, `MAX_LEVERAGE`, `ALLOWED_PAIRS` (`src/config.py`, `.env.example`).
- Test artefaktları eklendi: `INTEGRATION_TEST_PLAN.md`, `tests/test_parser.py`, `tests/test_approvals.py`.
- Güvenlik tarama raporu eklendi: `SECURITY_REVIEW.md`.
- Lokal sanal ortam oluşturuldu ve bağımlılıklar yüklendi (`.venv`, `pip install -r requirements.txt`).
- Testler çalıştırıldı: `.venv\\Scripts\\python -m pytest -q` sonucu `4 passed`.
- `DRY_RUN` executor doğrulaması örnek sinyal ile başarıyla çalıştırıldı.
- Otomatik smoke script eklendi ve doğrulandı: `scripts/dry_run_smoke.py`.
- Telegram dry-run UAT adımları dokümante edildi: `RUNBOOK.md`.
